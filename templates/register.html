<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ÄÄƒng kÃ½ tÃ i khoáº£n</title>
  <link rel="stylesheet" href="/static/style.css">
  <script src="/static/script.js" defer></script>
</head>
<body>
  <div class="container">
    <h2>ğŸ“‹ ÄÄƒng kÃ½ tÃ i khoáº£n sinh viÃªn</h2>

    <!-- BÆ°á»›c 1: Nháº­p thÃ´ng tin -->
    <form id="infoForm">
      <input type="text" name="user_id" placeholder="MÃ£ ngÆ°á»i dÃ¹ng" required>
      <input type="text" name="name" placeholder="Há» tÃªn" required>
      <input type="password" name="password" placeholder="Máº­t kháº©u" required>
      <button type="submit">LÆ°u thÃ´ng tin</button>
    </form>
    <p id="infoMsg"></p>

    <!-- BÆ°á»›c 2: QuÃ©t khuÃ´n máº·t -->
    <div id="faceSection" style="display:none;">
      <h3>âœ… ThÃ´ng tin Ä‘Ã£ lÆ°u, vui lÃ²ng quÃ©t khuÃ´n máº·t</h3>
      <video id="video" autoplay></video>
      <canvas id="canvas" style="display:none;"></canvas>
      <button id="captureFace">XÃ¡c nháº­n khuÃ´n máº·t</button>
      <p id="faceMsg"></p>
      <div id="nextStep" style="display:none; margin-top: 1rem;">
        <button onclick="window.location.href='/login.html'">ğŸ”‘ ÄÄƒng nháº­p ngay</button>
      </div>
    </div>
  </div>

  <script>
    const infoForm = document.getElementById("infoForm");
    const faceSection = document.getElementById("faceSection");
    const captureFace = document.getElementById("captureFace");
    const nextStep = document.getElementById("nextStep");

    let userId = "";

    infoForm.onsubmit = async (e) => {
      e.preventDefault();
      userId = infoForm.user_id.value.trim();

      const result = await postJSON("/register_info", {
        user_id: userId,
        name: infoForm.name.value,
        password: infoForm.password.value,
        role: "student"
      });

      showMessage("infoMsg", result.message || result.detail, result.success !== false);

      if (result.success !== false) {
        faceSection.style.display = "block";
        startCamera();
      }
    };

    captureFace.onclick = async () => {
      const image = captureImage();
      const result = await postJSON("/upload_face", {
        user_id: userId,
        image_data: image
      });
      showMessage("faceMsg", result.message || result.detail, result.success !== false);

      if (result.success) {
        nextStep.style.display = "block";
      }
    };
  </script>
</body>
</html>
