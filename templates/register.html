<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ÄÄƒng kÃ½ tÃ i khoáº£n</title>
  <link rel="stylesheet" href="/static/style.css">
  <script src="/static/script.js" defer></script>
</head>
<body>
  <div class="container">
    <h2>ÄÄƒng kÃ½ tÃ i khoáº£n sinh viÃªn</h2>

    <!-- BÆ°á»›c 1: Nháº­p thÃ´ng tin -->
    <form id="infoForm">
      <input type="text" name="student_id" placeholder="MÃ£ sinh viÃªn" required>
      <input type="text" name="name" placeholder="Há» tÃªn" required>
      <input type="password" name="password" placeholder="Máº­t kháº©u" required>
      <button type="submit">LÆ°u thÃ´ng tin</button>
    </form>
    <p id="infoMsg"></p>

    <!-- BÆ°á»›c 2: QuÃ©t khuÃ´n máº·t -->
    <div id="faceSection" style="display:none;">
      <h3>âœ… ThÃ´ng tin Ä‘Ã£ lÆ°u, vui lÃ²ng quÃ©t khuÃ´n máº·t</h3>
      <video id="video" autoplay></video>
      <canvas id="canvas" style="display:none;"></canvas>
      <button id="captureFace">XÃ¡c nháº­n khuÃ´n máº·t</button>
      <p id="faceMsg"></p>

      <!-- NÃºt Ä‘Äƒng nháº­p sau khi xÃ¡c thá»±c thÃ nh cÃ´ng -->
      <button id="goToLogin" style="display:none; margin-top: 1rem;" onclick="window.location.href='/login.html'">
        ğŸ” ÄÄƒng nháº­p ngay
      </button>
    </div>
  </div>

  <script>
    const infoForm = document.getElementById("infoForm");
    const faceSection = document.getElementById("faceSection");
    const captureFace = document.getElementById("captureFace");
    const goToLogin = document.getElementById("goToLogin");
    let studentId = "";

    infoForm.onsubmit = async (e) => {
      e.preventDefault();
      studentId = infoForm.student_id.value;

      const result = await postJSON("/register_info", {
        student_id: studentId,
        name: infoForm.name.value,
        password: infoForm.password.value,
        role: "student"
      });

      showMessage("infoMsg", result.message || result.detail, result.success !== false);

      if (result.success !== false) {
        faceSection.style.display = "block";
        startCamera();
      }
    };

    captureFace.onclick = async () => {
      const image = captureImage();
      const result = await postJSON("/upload_face", {
        student_id: studentId,
        image_data: image
      });

      showMessage("faceMsg", result.message || result.detail, result.success !== false);

      // âœ… Hiá»‡n nÃºt Ä‘Äƒng nháº­p náº¿u thÃ nh cÃ´ng
      if (result.success !== false) {
        goToLogin.style.display = "inline-block";
      }
    };
  </script>
</body>
</html>
